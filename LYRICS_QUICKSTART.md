# 歌词功能快速入门

## 🚀 快速开始

### 第一步：启动后端服务器

```bash
cd backend
go run main.go
```

后端将在 `http://localhost:8080` 启动

### 第二步：启动Flutter应用

```bash
flutter run
```

### 第三步：使用歌词功能

#### 方法1：上传并自动绑定（推荐）

1. 📱 打开音乐播放器
2. ▶️ 播放任意一首歌曲
3. 🎵 点击播放器控制栏的"歌词"图标（♪）
4. ✏️ 点击"管理歌词"图标（笔记本）
5. 📤 点击"上传"按钮
6. 📁 选择LRC歌词文件（可以使用项目中的 `example_lyrics.lrc`）
7. ✅ 上传完成后会自动绑定并显示歌词

#### 方法2：先上传后绑定

1. 📤 使用API上传歌词（不指定music_id）
2. ▶️ 播放歌曲
3. ✏️ 点击"管理歌词"按钮
4. 🔍 搜索或浏览歌词列表
5. 🔗 点击"绑定"按钮

## 📋 测试用例

### 使用示例歌词文件

项目中包含了一个示例歌词文件：`example_lyrics.lrc`

1. 上传任意音乐文件
2. 播放该音乐
3. 上传 `example_lyrics.lrc`
4. 查看歌词同步效果

### 创建自己的LRC歌词

创建一个文本文件，内容如下：

```lrc
[00:00.00]这是第一句歌词
[00:05.50]这是第二句歌词
[00:10.00]这是第三句歌词
```

保存为 `.lrc` 文件后上传即可。

## 🎯 功能演示

### 1. 歌词显示效果
- 当前播放行会**高亮显示**并使用更大的字体
- 歌词会**自动滚动**跟随播放进度
- 平滑的**动画过渡**

### 2. 无歌词提示
- 如果歌曲没有绑定歌词，会显示友好的提示
- 点击提示区域可以直接打开歌词管理对话框

### 3. 歌词搜索
- 在管理对话框中输入关键词
- 支持按**歌曲名称**和**艺术家**搜索
- 实时显示搜索结果

## 🔧 API调用示例

### 使用curl测试

```bash
# 1. 登录获取token
curl -X POST http://localhost:8080/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'

# 2. 上传歌词
curl -X POST http://localhost:8080/api/lyrics/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@example_lyrics.lrc" \
  -F "title=示例歌曲" \
  -F "artist=示例艺术家" \
  -F "music_id=1"

# 3. 获取歌词
curl http://localhost:8080/api/lyrics/get?music_id=1 \
  -H "Authorization: Bearer YOUR_TOKEN"

# 4. 搜索歌词
curl http://localhost:8080/api/lyrics/search?keyword=示例 \
  -H "Authorization: Bearer YOUR_TOKEN"

# 5. 绑定歌词
curl -X POST http://localhost:8080/api/lyrics/bind \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"music_id":1,"lyrics_id":2}'
```

## 📱 界面说明

### 音乐播放器界面

```
┌─────────────────────────────────┐
│  音乐播放器           [分享] [上传] │
├─────────────────────────────────┤
│  [搜索框]              [搜索]    │
├─────────────────────────────────┤
│                                 │
│  📃 音乐列表                     │
│                                 │
│  或                             │
│                                 │
│  🎵 歌词显示面板                 │
│     (点击歌词按钮切换)            │
│                                 │
├─────────────────────────────────┤
│  当前播放: 歌曲名    [🎵] [✏️]   │
│  ━━━━━━━━●━━━━━━━  00:00/03:45  │
│  [🔁] [⏮] [▶️] [⏭] [ ]          │
└─────────────────────────────────┘
```

### 歌词管理对话框

```
┌─────────────────────────────────┐
│  选择歌词                    [✖] │
│  歌曲名 - 艺术家                 │
├─────────────────────────────────┤
│  [搜索框]           [上传]       │
├─────────────────────────────────┤
│  📄 歌词1  艺术家1    [绑定]     │
│  📄 歌词2  艺术家2    [已绑定]   │
│  📄 歌词3  艺术家3    [绑定]     │
│                                 │
└─────────────────────────────────┘
```

## ⚡ 性能提示

1. **歌词文件大小**：建议小于1MB
2. **搜索优化**：使用精确的关键词
3. **缓存机制**：已播放的歌词会缓存在内存中
4. **自动清理**：删除音乐时，绑定关系会自动清除

## 🐛 常见问题

### Q: 歌词不显示？
A: 检查以下几点：
1. 歌曲是否已绑定歌词
2. 歌词文件格式是否正确
3. 点击"歌词"按钮是否已打开歌词面板

### Q: 歌词不同步？
A: 
1. 检查LRC文件的时间标签是否准确
2. 确保时间格式为 `[mm:ss.xx]`
3. 尝试重新播放歌曲

### Q: 上传失败？
A:
1. 确保文件格式为 `.lrc` 或 `.txt`
2. 检查文件大小是否超过10MB
3. 确认已登录并获取有效token

### Q: 搜索无结果？
A:
1. 确保已上传歌词
2. 尝试使用更简短的关键词
3. 检查歌词的标题和艺术家信息

## 📖 更多信息

- 详细使用指南：[LYRICS_GUIDE.md](LYRICS_GUIDE.md)
- 实现文档：[LYRICS_IMPLEMENTATION.md](LYRICS_IMPLEMENTATION.md)
- API文档：见 `LYRICS_GUIDE.md` 的API接口说明部分

## 🎉 祝使用愉快！

如有问题或建议，欢迎反馈！
